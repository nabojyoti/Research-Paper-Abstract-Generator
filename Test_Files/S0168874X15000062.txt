@&#MAIN-TITLE@&#On the ‘most normal’ normal—Part 2

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           A new method to compute a point normal is proposed.


                        
                        
                           
                           This normal is the ‘most normal’ one. It maximizes the minimal angle with the surrounding planes.


                        
                        
                           
                           This provides an optimal boundary layer normal if it is in the visibility cone.


                        
                        
                           
                           Compared to approximate methods such as Fast Marching Methods, this is the exact solution.


                        
                        
                           
                           The Voronoi diagram of edges has been extended to the sphere.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Surface triangulation

Point normal

‘Most normal’ normal

Generalized Voronoi diagram on the sphere

Boundary layer mesh generation

@&#ABSTRACT@&#


               
               
                  In [1], a definition is given of the ‘most normal’ normal. This is the normal that minimizes the maximal angle with a given set of normals. The algorithm proposed does indeed compute a normal that verifies the previous property. However, this may not always be the ‘most normal’ normal. The previous normal should have more appropriately been called the ‘most visible’ normal. In the present work, an algorithm is designed to compute the real ‘most normal’ normal, namely the normal that maximizes the minimum angle with the planes carried by the triangles surrounding a point. This normal is the optimal point normal for boundary layer mesh generation if it is in the visibility cone. The algorithm consists in computing the generalized Voronoi diagram on the sphere of the edges created by the intersection between the triangles and the sphere. Numerical results illustrate the method, and compare with the previous algorithm.
               
            

@&#INTRODUCTION@&#

Surface triangulations are used to describe surfaces in many computer applications. Each triangle carries unambiguously a face normal, but some ambiguity may arise when defining a normal at the vertices or at the edges of the triangulation. Point normals are usually required in visualization [2], rendering [3], medical applications, boundary conditions in finite volume and finite elements solvers [4], free surface problems [5], coupled fluid-structure problems [6], tangent plane computations, curvature estimations [7,8], surface to surface interpolation [9], and so forth. One strategy to tackle the point normal computation is to consider the triangles as a discretization of a smooth surface. The problem therefore consists in providing a point normal as close as possible to the smooth surface normal. A different viewpoint is to consider the triangulation as a discrete object without specific connections to a smooth surface. In the context of a boundary layer mesh generator, prisms are extruded from the surface triangulation along the point normals [10–13]. An accurate computation of the normal is required, particularly along corners and ridges, since a bad normal may lead to a premature interruption of the boundary layer extrusion, a loss of orthogonality, or the creation of low quality elements.

In a previous work [1], a first definition of the ‘most normal’ normal was proposed. This normal minimizes the maximal angle with the face normals surrounding a given point. As noticed in Henrion et al. [14], this is one of many different definitions of a center of a cone. The algorithm proposed in the previous reference produces such a normal. Given the cone of normals emanating from the faces surrounding the vertex, the normal generated corresponds to the center of this cone. From a visibility standpoint, this normal is optimal by construction. For discrete remeshings, this provides a robust criterion to evaluate possible surface foldings [15,16]. It would therefore have been more appropriate to call it the ‘most visible’ normal. Fig. 1
                      shows nevertheless a drawback of this approach. Regardless of the local convexity or concavity, the same visibility cone is generated at the vertex. As noticed in [17], there is a duality between the plane carried by the triangles surrounding a vertex, and the face normals carried by these faces. In the projective plane [18], lines and points are dual objects, which can be interpreted on the sphere as a duality between three dimensional planes that contain the origin, and normals. Therefore, the dual strategy of minimizing the maximal angle between a vector and some face normals would be to maximize the minimum angle between this vector and the planes carried by the triangles. Fig. 2
                      depicts the same configurations seen from the dual viewpoint. While it seems similar in a two dimensional representation, it is not in three dimensions, since in two dimensions a point normal aligned on the bisector defines only two angles. Therefore minimizing the maximal angle is equivalent to maximizing the minimal angle.

The normality concept inherits from a scalar product definition. Since a scalar product also defines a distance, it is clear that there is an intimate relationship between normality and distance. For example, for a 
                        G
                        1
                      surface [19], a tangent plane is available. Therefore the normal is computed as a normal to a plane, relying on the well-known cross product formula of the tangent vectors. However, degenerate patches may be created due to a particular parameterization. This does not mean that the normal does not exist. Some references [20,21] propose methods to compute normals for these situations. More generally, if a distance can be defined, a normal vector can also be obtained. A distance field is generated by resolving the Eikonal equation [22,23]. Normals are then obtained as a by product of the distance field through its gradient.

The organization of this paper is as follows. In Section 2, a short review of previously proposed normal computations is given. Then, Section 3 presents the algorithm to compute the ‘most normal’ normal, relying on the spherical generalized Voronoi diagram. Section 4 focuses in detail on the algebra and implementation of the spherical generalized Voronoi diagram. Finally, Section 5 illustrates the method through numerical examples.

Normal computation can be envisioned from different viewpoints depending on the application. As previously mentioned, a first viewpoint relies on the geometry of an underlying smooth surface that interpolates the vertices. When considering the point normal computation from an interpolation viewpoint, a generic strategy consists in taking a weighted average of all the face normals connected to a given point and normalizing it. With unit weights [2], a least-square approximation of the normal is sought. Some straightforward variations consider a different weighted average of the face normals according to Frey et al. [24]:
                        
                           •
                           weighted with the surface area of each triangle,

weighted with the inverse of the surface area,

weighted with the angle made by the two edges connected in the point under consideration.

A second viewpoint may be based on a pure discrete setting. A direct application of this approach is boundary layer mesh generation, where the discrete surface is more relevant than the CAD smooth surface, since it will influence the quality of the generated elements. Within this context, the previous strategies may fail to produce either the ‘most visible’ normal or the ‘most normal’ normal because they are not associated with any theoretical optimum. Regarding the ‘most visible’ normal, a simple example is given by Pirzadeh in [27] where the trailing edge of a wing is meshed with four elements on the upper part and three on the lower part of the wing, producing an unbalanced normal in case of unit weights. A notable improvement was proposed in the context of RANS gridding by Kallinderis [11], based on the visibility cone of each point. The algorithm consists in choosing the pair of normals which produces the largest angle, taking a plane bisector of this faces, limiting the visibility on this plane by projecting the other faces on this plane, and finally taking the bisector of the angle created by the edges which limit the most the visibility in this plane. This normal is always valid if the faces allow it. Closely related, Pirzadeh in [27], proposed an iterative method relying on a predictor corrector basis. Finally, Aubry et al. [1] provide the optimum normal, as far as visibility is concerned.

A different approach was followed by Sani et al. [4], where normals are computed to satisfy the discrete incompressibility condition in a finite element context. Normals are then fully imposed on the mass conservation criterion, not considering the geometrical aspect of the boundary.

Finally, Wang et al. solve the Eikonal equation in [28] to offset the surface in the direction of the gradient of the solution. This work interestingly shifts the problem from a geometric triangle evaluation to a distance evaluation, where ultimately the normal is extracted as the gradient of the distance field. A similar approach is also proposed by Flin et al. [3], without relying on any triangulated surface.

In this section, the main goal is to seek the normal that maximizes the minimal angle with the faces surrounding the vertex. Instead of computing vector to vector angles, vector to plane angles are involved, where all the vectors can be identified with a point on the unit sphere, and all the planes need only two points to be defined since they all contain the origin. The task is much more complex. Before, the ‘most visible’ normal was minimizing the maximum angle between normals, creating the largest cone that includes all normals. The dual strategy is equivalent to maximizing the minimum plane angle since the face and plane angles are linked through a 
                        α
                        =
                        (
                        π
                        /
                        2
                        )
                        −
                        β
                      relationship. In terms of geodesic distance on the sphere, for the ‘most visible’ normal, the face normals were creating points on the unit sphere, and the goal was to obtain a point on the sphere that minimized the geodesic distance with all the other points. In this new approach, the new point should maximize the distance with the trace of the surrounding faces on the sphere, namely arcs of great circles. While the first method was closely related to the farthest Voronoi diagram of points, the new one consists in computing the generalized Voronoi diagram of arcs on the sphere. Every vertex of this generalized Voronoi diagram will be at the center of a small circle, therefore maximizing the geodesic distance. The possibly nonunique centers that have the maximum radius will define the ‘most normal’ normal.

In order to compute the generalized Voronoi diagram, one of the first methods in the plane is the one proposed by Lee [29]. Yao et al. [30] design a simpler algorithm to compute it. Regarding the Voronoi diagram on the sphere, Dinis et al. [31] and Zheng et al. [32] generalize the point Voronoi diagram to the sphere. Finally, Na et al. [33] propose to build an arbitrary spherical Voronoi diagram from two planar Voronoi diagrams of the same type and some clever merging of both diagrams, relying on early results from Brown [34]. As shown in Yao et al. [30], reflex edges generate multiple rays in the generalized Voronoi diagram to build rays associated with vertices. Reflexivity, or concavity, is not conserved from a two dimensional Voronoi diagram to a three dimensional diagram. Even though the stereographic projection does conserve angles, only the mapped edges abut with the same angles, while the straight edges, which are the relevant ones, do not. In the current work, the diagram is therefore computed in three dimensions. As we are interested in only one part of the Voronoi diagram on the whole sphere, the algorithm proposed in Yao et al. [30] extended to the spherical Voronoi diagram seems to be the algorithm of choice.

Regarding the original algorithm proposed in [30], the main idea is to build the diagram outside in. Note the similarity between the original sweeping of Fortune [35], Yao et al. [30] outside in sweeping, a boundary layer mesh extrusion [10–13] and a fast marching method [22]. They all rely on the hyperbolic character of the Eikonal equation. After having oriented consistently the boundary edges, bisectors (named rays in [30]) are created at each boundary vertex. Based on the distance properties of the Voronoi diagram, a first local test is performed on four consecutive rays to evaluate if the two central rays intersect, and if so, if the intersection point is closer to the boundary than the intersection of the new ray with the outer rays. If the test is successful, a new ray is created. However, only a subpart of the diagram has been considered for proximity, and fronts developing from the diagram may invalidate the creation of this new ray. Some interesting remarks are made by Edwards in [36]. For example, the backtracking method proposed originally may be replaced by a proximity check, which leads to an even more straightforward algorithm. We also have found it possible to speed up the algorithm by not scanning the circular list again and again while the diagram may only generate a few edges at each round. The four rays to be tested may be put in a stack where only four not yet tested consecutive rays may be removed from the stack. The final algorithm is displayed in Algorithm 1. An illustration of the algorithm is depicted in Fig. 3
                      in two dimensions for the sake of clarity.
                        Algorithm 1
                        Spherical medial axis. 
                              
                                 
                                    
                                    
                                       
                                          Given a set of triangle faces surrounding a point 
                                                P
                                             , a set of oriented edges containing the points of the faces excluding 
                                                P
                                             , and the ‘most visible’ normal:
                                       
                                       
                                          1:Order the 3D edges
                                       
                                       
                                          2:Check convexity to create the initial rays
                                       
                                       
                                          3:
                                             while There are at least four rays in the stack of active rays do
                                          
                                       
                                       
                                          4:Get four contiguous active rays iray
                                             0, iray
                                             1, iray
                                             2 and iray
                                             3
                                          
                                       
                                       
                                          5:
                                             if (intersect(iray
                                             1, iray
                                             2)) then
                                          
                                       
                                       
                                          6:
                                             
                                             if (rendez-vous(iray
                                             0, iray
                                             1, iray
                                             2, iray
                                             3)) then
                                          
                                       
                                       
                                          7:
                                             
                                             if (Not_too_close()) then
                                          
                                       
                                       
                                          8:
                                             
                                             Remove iray
                                             1 and iray
                                             2 from the circular list and replace them by a new ray
                                       
                                       
                                          9:
                                             
                                             end if
                                          
                                       
                                       
                                          10:
                                             
                                             end if
                                          
                                       
                                       
                                          11:
                                             end if
                                          
                                       
                                       
                                          12:
                                             end while
                                          
                                       
                                       
                                          13:From the last two rays, built the complete diagram tree.
                                       
                                       
                                          14:Find the largest circumcircle center locations in the diagram. This may be vertices or edges in the diagram.
                                       
                                       
                                          15:Find the closest location on the largest circumcircle center locations to the ‘most visible’ normal. This is the ‘most normal’ normal.
                                       
                                    
                                 
                              
                           
                        

The previous algorithm is a generic version of a Voronoi diagram generation. In this section, the specialization to the unit sphere is described. First, the different ray types appearing on the sphere are reviewed. Then, intersections based on the ray type are described. Distance computations are treated next. Finally, containment is considered. Since planes are identified with curved edges, and vertices are identified with vectors, these terms are used interchangeably.

In the nomenclature of Yao et al. [30], rays are bisectors. There are three kinds of rays:
                           
                              •
                              Plane/plane bisectors: On the sphere, as noted before, circular edges are the intersection between the triangles around a vertex and the sphere. Therefore, a bisector of two circular edges on the sphere is a circular edge, which is defined by the intersection of the sphere and a plane that is the bisector of both planes carried by the two edges.

Vertex/plane bisectors: These are the equivalent of parabolas in the plane. Dinis et al. [31] and Zheng et al. [32] show the equation of parabolas on the sphere, which actually correspond to projected ellipses, as parabolas reconnect at infinity in the projective plane [18].

Vertex/vertex bisectors: These are great circles carried by planes that contain the origin. They split the angle between both vertices in two equal angles.

As previously seen, there are three types of rays. However, only two are relevant geometrically, depending whether the bisector is a great circle or a parabola. They are presented in the next parts.

We consider first the case where two rays associated with two plane bisectors intersect. On the sphere, a plane is defined only by its normal since the origin belongs to the plane. This is the classical duality between lines and points seen in the projective plane [18]. Given two planes 
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                           , and their respective vectors 
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                           , the intersection line belongs to both planes, and is therefore normal to both vectors. Therefore the intersection line direction is carried by the vector 
                              
                                 
                                    V
                                 
                                 
                                    3
                                 
                              
                            such that :
                              
                                 (1)
                                 
                                    
                                       
                                          V
                                       
                                       
                                          3
                                       
                                    
                                    =
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    ×
                                    
                                       
                                          V
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           The intersection gives two points on the intersection line at unit distance from the origin. There is always an intersection between two planes that contain the origin on the sphere. The plane normal defines an orientation on the plane that is inherited by the ordering of the edge loop. It is consistent with the ray direction. Since the two intersection points and the origin of one of two input rays are in the same plane, they define an orientation. Furthermore, all three points belong to a circle, which is the intersection of one of two planes with the sphere, and is obviously convex. Comparing the orientation of the plane normal to the orientation of the three points in the plane, an orientation of the circle can therefore be sought. The first point found along the circle from the ray origin, given the ray direction, can be unambiguously determined. This is equivalent to ordering the intersection points based on their curvilinear abscissae along the bisector.

Let us consider now the case where one ray associated with one plane bisector intersects another ray associated with a parabolic bisector. As shown in [32,31], the locus at the same geodesic distance from a point to a great circle on the sphere has the form:
                              
                                 (2)
                                 
                                    
                                       
                                          x
                                          ·
                                          (
                                          n
                                          +
                                          p
                                          )
                                       
                                       
                                          2
                                          (
                                          1
                                          +
                                          c
                                          )
                                       
                                    
                                    +
                                    
                                       
                                          x
                                          ·
                                          (
                                          n
                                          −
                                          p
                                          )
                                       
                                       
                                          2
                                          (
                                          1
                                          −
                                          c
                                          )
                                       
                                    
                                    =
                                    1
                                 
                              
                           and:
                              
                                 (3)
                                 
                                    ∥
                                    x
                                    ∥
                                    =
                                    1
                                 
                              
                           which corresponds to the intersection of an elliptic cylinder with the sphere. This can be rewritten:
                              
                                 (4)
                                 
                                    
                                       
                                          x
                                          ·
                                          
                                             
                                                v
                                             
                                             
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                a
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    +
                                    
                                       
                                          x
                                          ·
                                          
                                             
                                                v
                                             
                                             
                                                2
                                             
                                          
                                       
                                       
                                          
                                             
                                                b
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    =
                                    1
                                 
                              
                           and:
                              
                                 (5)
                                 
                                    ∥
                                    x
                                    ∥
                                    =
                                    1
                                 
                              
                           Therefore, by writing:
                              
                                 (6)
                                 
                                    x
                                    =
                                    a
                                    cos
                                    (
                                    t
                                    )
                                    
                                       
                                          v
                                       
                                       
                                          1
                                       
                                    
                                    +
                                    b
                                    sin
                                    (
                                    t
                                    )
                                    
                                       
                                          v
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    c
                                    D
                                 
                              
                           and using the normalized equation, one obtains:
                              
                                 (7)
                                 
                                    c
                                    =
                                    ±
                                    
                                       
                                          1
                                          −
                                          
                                             
                                                a
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                cos
                                             
                                             
                                                2
                                             
                                          
                                          (
                                          t
                                          )
                                          −
                                          
                                             
                                                b
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                sin
                                             
                                             
                                                2
                                             
                                          
                                          (
                                          t
                                          )
                                       
                                    
                                 
                              
                           if the quantity below the square root is positive.

We would like to compute the intersection of this curve with a plane. Instead of using this equation added with the plane equation, we prefer to first intersect the elliptic cylinder with the plane, giving an ellipse, and then to intersect it in the plane with a circle. A cylinder plane intersection algorithm is provided in [37]. However, the cylinder is elliptical here. Given the axis 
                              D
                            of the cylinder, the projection of a three dimensional vector on this plane is written:
                              
                                 (8)
                                 
                                    PX
                                    =
                                    (
                                    I
                                    −
                                    
                                       
                                          DD
                                       
                                       
                                          t
                                       
                                    
                                    )
                                    X
                                 
                              
                           Given the two axis of the ellipse in the three dimensional space 
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                           , the rotation matrix in the plane normal to the axis of the cylinder is
                              
                                 (9)
                                 
                                    R
                                    =
                                    (
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          V
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                              
                           With the ellipse semi axis a and b, the equation of the elliptic cylinder in the three dimensional space becomes
                              
                                 (10)
                                 
                                    
                                       
                                          (
                                          PRX
                                          )
                                       
                                       
                                          T
                                       
                                    
                                    E
                                    (
                                    PRX
                                    )
                                    =
                                    1
                                 
                              
                           Or:
                              
                                 (11)
                                 
                                    
                                       
                                          X
                                       
                                       
                                          T
                                       
                                    
                                    CX
                                    =
                                    1
                                 
                              
                           where:
                              
                                 (12)
                                 
                                    E
                                    =
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      
                                                         
                                                            a
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      
                                                         
                                                            b
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                              
                           and:
                              
                                 (13)
                                 
                                    C
                                    =
                                    
                                       
                                          R
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          T
                                       
                                    
                                    EPR
                                 
                              
                           Writing the plane equation in parametric form:
                              
                                 (14)
                                 
                                    X
                                    =
                                    λ
                                    A
                                    +
                                    μ
                                    B
                                 
                              
                           Plugging the last equation into the cylinder equation, one obtains:
                              
                                 (15)
                                 
                                    
                                       
                                          c
                                       
                                       
                                          0
                                       
                                    
                                    
                                       
                                          λ
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    λ
                                    μ
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          μ
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    1
                                 
                              
                           with:
                              
                                 (16)
                                 
                                    
                                       
                                          c
                                       
                                       
                                          0
                                       
                                    
                                    =
                                    
                                       
                                          A
                                       
                                       
                                          T
                                       
                                    
                                    CA
                                 
                              
                           
                           
                              
                                 (17)
                                 
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          A
                                       
                                       
                                          T
                                       
                                    
                                    CB
                                 
                              
                           
                           
                              
                                 (18)
                                 
                                    
                                       
                                          c
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          B
                                       
                                       
                                          T
                                       
                                    
                                    CB
                                 
                              
                           In [37], a trick is presented to eliminate the term c
                           1. By using the projection of 
                              D
                            onto the plane as the vector 
                              A
                            and the vector normal to both 
                              D
                            and 
                              A
                            for 
                              B
                           , this term disappears for the circular cylinder as
                              
                                 (19)
                                 
                                    
                                       
                                          A
                                       
                                       
                                          T
                                       
                                    
                                    CB
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                r
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          A
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          T
                                       
                                    
                                    PB
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                r
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       
                                          A
                                       
                                       
                                          T
                                       
                                    
                                    PB
                                 
                              
                           where r is the radius of the cylinder, and because 
                              P
                            is a symmetric projector. However, this is not possible in the elliptical case. Nevertheless, this represents the equation of an ellipse in the parametric plane. After diagonalizing the equation, the eigenvalues a
                           1 and b
                           1 and the two dimensional eigenvectors are computed. Similarly, it is now easy to compute the three dimensional vectors 
                              
                                 
                                    A
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    B
                                 
                                 
                                    1
                                 
                              
                            corresponding to the two dimensional vectors. Once the axis of the ellipse is found, the intersection between an ellipse and a circle is sought:
                              
                                 (20)
                                 
                                    
                                       
                                          c
                                       
                                       
                                          0
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    xy
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    1
                                 
                              
                           and
                              
                                 (21)
                                 
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          y
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           After some simple algebra, the final solution is
                              
                                 (22)
                                 
                                    x
                                    =
                                    ±
                                    
                                       
                                          a
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (23)
                                 
                                    y
                                    =
                                    ±
                                    
                                       
                                          b
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      2
                                                   
                                                
                                                −
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           The four intersection points are
                              
                                 (24)
                                 
                                    P
                                    =
                                    (
                                    ±
                                    x
                                    
                                       
                                          A
                                       
                                       
                                          1
                                       
                                    
                                    )
                                    +
                                    (
                                    ±
                                    y
                                    
                                       
                                          B
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                              
                           Since the intersections should be above the plane included in the definition of the parabola, two intersections can be discarded. We are left with the two intersections belonging to the same closed curve. Relying again on the plane orientation argument, a unique solution is finally obtained.

Finally, note that a degenerate case may appear if the vertex is collinear to the plane normal, in which case the bisector is not an ellipse anymore but a small circle.

Given a location on the sphere, a building block of the Voronoi diagram consists in computing the distance from this location to a site (a vertex or an edge).

On the sphere, the geodesic distance is proportional to the angle described by the two vectors given by the two locations. Therefore, the simple formula used to compute the distance between two vectors 
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    v
                                 
                                 
                                    2
                                 
                              
                            is
                              
                                 (25)
                                 
                                    d
                                    =
                                    1
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          1
                                       
                                    
                                    ·
                                    
                                       
                                          v
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                        

The distance therefore increases with the angle, from 0 when both vectors are collinear with the same direction, up to 2 if both vectors are collinear with an opposite direction.

An “oriented” distance is also used to differentiate between the geodesic distance and the complement of the geodesic distance when necessary. Bisectors are oriented from outside in, therefore carrying an orientation of the Voronoi edges. On the other hand, there is no need to make a distinction when a proximity search is performed, since it is always the smallest distance that is of interest in this case. This “oriented” distance computation is displayed in Algorithm 2.
                              Algorithm 2
                              Oriented distance between a point 
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                  and a point 
                                    
                                       
                                          P
                                       
                                       
                                          2
                                       
                                    
                                 . 
                                    
                                       
                                          
                                          
                                             
                                                1:Given the points 
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   , 
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                    and a normal 
                                                      n
                                                   :
                                             
                                             
                                                2:Compute the vector 
                                                      v
                                                      =
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ×
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                3:Normalize 
                                                      v
                                                   
                                                
                                             
                                             
                                                4:
                                                   if 
                                                   
                                                      v
                                                      ·
                                                      n
                                                      <
                                                      0
                                                    
                                                   then
                                                
                                             
                                             
                                                5:
                                                   
                                                      dist
                                                      =
                                                      1
                                                      −
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                6:
                                                   else
                                                
                                             
                                             
                                                7:
                                                   
                                                      dist
                                                      =
                                                      2
                                                      +
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                8:
                                                   end if
                                                
                                             
                                          
                                       
                                    
                                 
                              

As seen before, an edge on a sphere is a curve. This edge defines a section of the sphere as shown in Fig. 4
                           . Vector 
                              
                                 
                                    A
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    A
                                 
                                 
                                    2
                                 
                              
                            is normal to the plane containing the origin and the two endpoints of the edge. The intersection of the line carried by this vector and the sphere creates two poles. The sphere is divided into three parts, each being a Voronoi cell of the spherical generalized Voronoi diagram of the edge. The cell that includes the edge, represented by the spherical surface of the slice created by the edge, requires a projection on the edge to get the closest point, and then computing the distance. The other two cells delimited by the great circles including the endpoints and the poles are closer to the endpoint they contain. There is a great similarity with the planar case [38] except that the two cells corresponding to the endpoints are not connected in the plane, while they meet at infinity on the sphere. Algorithm 3 describes the edge distance computation. Compared to a two dimensional version, the sections at infinity meet again on the other side of the sphere.
                              Algorithm 3
                              Geodesic distance from a point 
                                    P
                                  to an edge 
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          2
                                       
                                    
                                 . 
                                    
                                       
                                          
                                          
                                             
                                                1:Given a point 
                                                      P
                                                    and an edge 
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   :
                                             
                                             
                                                2:Compute the normal 
                                                      N
                                                    to 
                                                      
                                                         
                                                            OP
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                    and 
                                                      
                                                         
                                                            OP
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                3:Project 
                                                      P
                                                    onto the plane containing the origin 
                                                      O
                                                    and normal to 
                                                      N
                                                    to get 
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            proj
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                4:Normalize 
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            proj
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                5:
                                                   if 
                                                   
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            proj
                                                         
                                                      
                                                    is inside the curved triangle 
                                                      (
                                                      
                                                         
                                                            OP
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      )
                                                    
                                                   then
                                                
                                             
                                             
                                                6:
                                                   
                                                      d
                                                      =
                                                      1
                                                      −
                                                      P
                                                      ·
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            proj
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                7:
                                                   else
                                                
                                             
                                             
                                                8:Determine which of the last two cells 
                                                      
                                                         
                                                            P
                                                         
                                                         
                                                            proj
                                                         
                                                      
                                                    belongs to.
                                             
                                             
                                                9:Get the distance from the edge endpoint belonging to this cell to 
                                                      P
                                                   .
                                             
                                             
                                                10:
                                                   end if
                                                
                                             
                                          
                                       
                                    
                                 
                              

Sweeping twice the sphere is required in [31,32] to obtain the complete Voronoi diagram. Being interested in only one part of the generalized Voronoi diagram, a requirement is then to be able to classify if an intersection point is inside the portion of the sphere studied or not. Finding if a point on the sphere is inside a closed domain is not trivial, and is closely related to find if a point is contained in a polygon [39,37]. One option relies on parameterizing the sphere first, and then reparameterizing the mapped circular edges on the parametric plane. The previous problem becomes then a two dimensional containment problem. Since the ‘most visible’ normal is required to get a unique solution, an easier method may be designed. By definition, if the ‘most visible’ normal exists, it sees the normals of the surrounding faces. By rotating the Cartesian frame in a basis formed by the tangent plane of the ‘most visible’ normal and the ‘most normal’ normal, the sphere can be cut in slices defined by great circles that contain the boundary vertices. This is very similar to Fig. 4, except that the ‘most visible’ normal is the main axis, which is not in general normal to the plane carried by the edges of the Voronoi diagram. Given an arbitrary point, once the appropriate slice it belongs to has been found, a test to see if the point belongs to the appropriate semispace bounded by the plane carrying the curved edge will determine if the point is inside or outside. The trick used here is based on the fact that the underlying spherical polygon is spherically star-shaped. This is not a requirement for the generalized Voronoi diagram. However, if the polygon is not star-shaped, there is no valid normal that can see all the surrounding faces. This case is therefore excluded here.

In this section, different geometric scenarii have been chosen to illustrate the method. Regarding the CPU cost of the current method, the same argument advocated in [1] is put forward. The complexity of the basic ‘most visible’ normal is 
                        O
                        (
                        
                           
                              n
                           
                           
                              4
                           
                        
                        )
                      where n is the number of input vectors, even though a linear complexity algorithm exists [40]. The one of the ‘most normal’ normal is roughly linear. However, since the number of faces surrounding a point is bounded in a typical computational mesh, both complexities drop to constant. Again, a first standard average may be computed to see if the surface is locally complex, and only then trigger the algorithm. Compared to the gains of generating a three dimensional well formed boundary layer, the CPU cost is trifling. Furthermore, the examples shown below are exaggerated since in practice, multiple normals would alleviate the lack of visibility around convex ridges. In the following examples, the ‘most visible’ cone is also displayed. This is the cone whose center is given by the ‘most normal’ normal, and whose angle with its center is the angle that minimizes the maximal angle with all the other face normals. Its intersection with the sphere defines an area, which is in general different than the spherical area where visibility is guaranteed. This area is the intersection of the sphere with all the half planes defined by the triangular faces, and is the spherical dual of the kernel of a polygon [41].

First, a pure concave corner is studied. The concave corner depicted in Fig. 5
                         represents the simplest case to visualize the algorithm. There are no multiple rays per points since there is no convexity between the planes of the triangular faces. All the rays meet at a center, which is geodesically equidistant to all the edges. In this case, the ‘most visible’ normal and the ‘most normal’ normal coincide. Some degeneracy is present since some triangles are coplanar.

Then, a pure convex corner is studied. The corner is displayed in Fig. 6
                         and presents a more complex diagram. Every other boundary convex point has two rays to take into account convexity. Some degeneracy is also present. Every planar section has a similar Voronoi cell due to symmetry. The four cells associated to the four convex boundary points are clearly visible. The ‘most normal’ normal coincides again with the ‘visible normal’. However, even though the visibility cones coincide between this example and the previous one, there is a complete discrepancy of their Voronoi diagram.


                        Fig. 7
                         represents a mixed concave convex corner with one convex ridge and two concave ridges. It is one of the most common configurations. In order to make the example slightly more complex, two pairs of planar neighboring faces have been changed to add some concavity in order to create some small parabolic rays in the diagram. Due to the convex edge, two rays are also generated at the convex tip. This is a case where the ‘most normal’ and the ‘most visible’ normal do not coincide. The ‘most visible’ normal is much geodesically closer to the faces than the ‘most normal’ normal, as expected from the theoretical considerations.

Another concave convex corner is studied here. It has two convex ridges and one concave ridge and is displayed in Fig. 8
                        . It is again a very common corner configuration. Compared to the previous example, the orientation of the faces has been changed. Regarding the ‘most visible’ normal, the direction is inverted, as the algorithm is symmetric to a face orientation change. Regarding the ‘most normal’ normal, the situation is completely different. Not only are the two normals quite different, but the ‘most normal’ normal is not even in the visibility region of the corner. Compared to the last example, the ‘most visible’ cones are the same, while the ‘most normal’ normals are not, with again a strongly different Voronoi diagram.

This example was shown in [12] as one of the most difficult corners for boundary layers. It is an arbitrary succession of concave and convex corners. Regarding its Voronoi diagram, the coverage of the face is almost maximal. It is displayed in Fig. 9
                        . The ‘most visible’ cone is extremely tight, as expected. Both normals are identical, although multiple normals are strictly necessary if some boundary mesh is desired.

This example has been proposed by Sharov et al. in [42], and used in [12]. In the original version, there is no single normal that can see all the faces. Therefore, the example has been slightly changed to decrease the angle between the two planes that have opposite direction. The Voronoi diagram is shown in Fig. 10
                        . Close to the two convex vertices, the parabolic branches are clearly seen. They smoothly blend into a great circle that divides the are between the two convex vertices. As stated before, the visibility cone is extremely tight. For this extreme example, the ‘most normal’ normal does not belong to the visibility cone.

@&#CONCLUSION@&#

The ‘most normal’ normal algorithm proposed in [1] has been revisited. The normal vector proposed previously minimizes the maximal angle with the face normals surrounding a vertex. Because it produces an optimal normal as far as visibility is concerned, the old method has been recast as the ‘most visible’ normal. However, this does not imply that it maximizes the minimal angle with the planes of the faces surrounding the vertex, which is much closer to a normality notion.

Compared to approximate distance computations [22,43], the current algorithm provides the optimal normal, but considering only local neighborhoods, since no global effects such as colliding fronts are taken into account. If the first method was related to a farther Voronoi point diagram, the new algorithm is based on its dual, the standard Voronoi diagram, with the peculiarities that edges are involved instead of points, and the diagram takes place on the unit sphere. Details of the algorithm on the sphere have been thoroughly described. Some numerical examples show the difference between both types of normals, and the benefits of this new algorithm regarding the quest of the ‘most normal’ direction.

As stated earlier, this algorithm is taking aim at solving the issues related to boundary layer mesh generation, when dealing with complex ridges and corners. Relying on an accurate normal computation to extrude the boundary layer mesh is crucial. Even though it may seem that normal computation is a technical and unimportant task, it belongs to this class of problems where details do matter tremendously. Numerous physical phenomena are often driven by the boundary geometry. Ridges, and more importantly corners, are locations where geometric discontinuities create physically relevant and complex phenomena. In these configurations, a premature halt of the boundary layer mesh may result in a misprediction of the computation.

From a practical viewpoint, as seen in some examples, the ‘most normal’ normal may not belong to the visibility cone, while the ‘most visible’ normal will always belong to the visibility cone if it exists. If a boundary layer is extruded, this may lead to inverted elements in the volume, even though normality has been maximized. If such scenario appears, it is a clue that multiple normals are necessary for complex corners. Nevertheless, the theoretical tool embodied in the ‘most normal’ normal, namely the spherical Voronoi diagram, will provide the foundations to build these multinormals in order to provide optimal normality and visibility. This will be the aim of future research.

@&#ACKNOWLEDGMENTS@&#

This work was partly supported by the DoD HPCMP CREATE Program.

@&#REFERENCES@&#

